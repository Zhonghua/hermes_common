<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>C++ documentation &mdash; hermes_common v0.5 documentation</title>
    <link rel="stylesheet" href="../static/default.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.5',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <link rel="top" title="hermes_common v0.5 documentation" href="../index.html" />
    <link rel="next" title="Python documentation" href="python.html" />
    <link rel="prev" title="Welcome to hermes_common’s documentation!" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="python.html" title="Python documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="Welcome to hermes_common’s documentation!"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">hermes_common v0.5 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="c-documentation">
<span id="cpp-doc"></span><h1>C++ documentation<a class="headerlink" href="#c-documentation" title="Permalink to this headline">¶</a></h1>
<p>This section documents the C++ interface of hermes_common. If you want to use
hermes_common from Python, see the <a class="reference external" href="python.html#python-doc"><em>Python documentation</em></a>.</p>
<p>Below we describe in detail how Hermes Common can be used from C++.</p>
<div class="section" id="using-python">
<h2>Using Python<a class="headerlink" href="#using-python" title="Permalink to this headline">¶</a></h2>
<p>Hermes Common provides a <tt class="docutils literal"><span class="pre">Python</span></tt> C++ class for easy interaction with Python.
Example:</p>
<div class="highlight-python"><pre>Python *p = new Python();
p-&gt;push("i", c2py_int(5));
p-&gt;exec("i = i*2");
int i = py2c_int(p-&gt;pull("i"));
_assert(i == 10);
delete p;</pre>
</div>
<p>As you can see, you just instantiate the <tt class="docutils literal"><span class="pre">Python</span></tt> class, which automatically
initializes Python and sets everything up, then you convert from C++ to Python
using the <tt class="docutils literal"><span class="pre">c2py_*</span></tt> functions, push it to the Python namespace using
<tt class="docutils literal"><span class="pre">p-&gt;push()</span></tt>, do whatever you have to do in Python using <tt class="docutils literal"><span class="pre">p-&gt;exec()</span></tt>, then
pull it back to C++ using <tt class="docutils literal"><span class="pre">p-&gt;pull()</span></tt> and finally converting from Python to
C++ using the <tt class="docutils literal"><span class="pre">py2c_*</span></tt> functions.</p>
<p>Python objects are properly allocated and deallocated (e.g. no memory leaks),
so you don&#8217;t have to worry about reference counting, as long as your code looks
like the example above.</p>
<p>Each <tt class="docutils literal"><span class="pre">Python</span></tt> instance has it&#8217;s own namespace, as demonstrated in this
example:</p>
<div class="highlight-python"><pre>Python *p1 = new Python();
Python *p2 = new Python();
p1-&gt;push("i", c2py_int(5));
p2-&gt;push("i", c2py_int(6));
p1-&gt;exec("i = i*2");
p2-&gt;exec("i = i*2");
int i1 = py2c_int(p1-&gt;pull("i"));
int i2 = py2c_int(p2-&gt;pull("i"));
_assert(i1 == 10);
_assert(i2 == 12);
delete p1;
delete p2;</pre>
</div>
</div>
<div class="section" id="matrix-support">
<h2>Matrix Support<a class="headerlink" href="#matrix-support" title="Permalink to this headline">¶</a></h2>
<div class="section" id="coomatrix">
<h3>CooMatrix<a class="headerlink" href="#coomatrix" title="Permalink to this headline">¶</a></h3>
<p>Example of creating a real CooMatrix:</p>
<div class="highlight-python"><pre>CooMatrix m(5);
m.add(1, 3, 3.5);
m.add(2, 3, 4.5);
m.add(3, 4, 1.5);
m.add(4, 2, 1.5);
m.add(2, 3, 1);
m.print();</pre>
</div>
<p>and then converting it to CSRMatrix:</p>
<div class="highlight-python"><pre>CSRMatrix n1(&amp;m);
n1.print();</pre>
</div>
<p>or CSCMatrix:</p>
<div class="highlight-python"><pre>CSCMatrix n2(&amp;m);
n2.print();</pre>
</div>
<p>Here is how to create a complex CooMatrix and then convert to a complex
CSRMatrix and CSCMatrix:</p>
<div class="highlight-python"><pre>CooMatrix m(5, true);
m.add(1, 3, cplx(3.5));
m.add(2, 3, cplx(4.5));
m.add(3, 4, cplx(1.5));
m.add(4, 2, cplx(1.5));
m.add(2, 3, cplx(1));
m.print();

// convert from COO
CSRMatrix n1(&amp;m);
n1.print();
CSCMatrix n2(&amp;m);
n2.print();</pre>
</div>
</div>
<div class="section" id="csrmatrix-and-coomatrix">
<h3>CSRMatrix and CooMatrix<a class="headerlink" href="#csrmatrix-and-coomatrix" title="Permalink to this headline">¶</a></h3>
<p>These matrices can&#8217;t be constructed from scratch, but you first have to create
some other matrix first (in most cases CooMatrix) and convert it to CSR
afterwards:</p>
<div class="highlight-python"><pre>CooMatrix m(5);
m.add(1, 3, 3.5);
m.add(2, 3, 4.5);
m.add(3, 4, 1.5);
m.add(4, 2, 1.5);
m.add(2, 3, 1);

CSRMatrix n1(&amp;m);
n1.print();</pre>
</div>
</div>
</div>
<div class="section" id="solvers">
<h2>Solvers<a class="headerlink" href="#solvers" title="Permalink to this headline">¶</a></h2>
<p>Hermes Common provides the following solvers:</p>
<div class="highlight-python"><pre>// Dense solvers:
void solve_linear_system_numpy(Matrix *mat, double *res);
void solve_linear_system_numpy(Matrix *mat, cplx *res);
void solve_linear_system_dense_lu(Matrix *mat, double *res);

// Sparse solvers:
void solve_linear_system_scipy_umfpack(Matrix *mat, double *res);
void solve_linear_system_scipy_umfpack(Matrix *mat, cplx *res);
void solve_linear_system_scipy_cg(Matrix *mat, double *res);
void solve_linear_system_scipy_gmres(Matrix *mat, double *res);
int solve_linear_system_cg(Matrix* A, double *x,
                           double matrix_solver_tol,
                           int matrix_solver_maxiter);</pre>
</div>
<p>They are mostly implemented in SciPy or NumPy (except
<tt class="docutils literal"><span class="pre">solve_linear_system_dense_lu</span></tt> and <tt class="docutils literal"><span class="pre">solve_linear_system_cg</span></tt> that are
actually implemented in Hermes Common itself in C++) and the implementation
just uses the <tt class="docutils literal"><span class="pre">Python</span></tt> class to call the corresponding SciPy/NumPy function.
As you can see, all of them accept the abstract Matrix class, so you can supply
a matrix in any format you want and it will be automatically converted (if
needed) to the format that the solver needs (e.g. umfpack needs CSCMatrix,
numpy needs DenseMatrix and so on).</p>
<p>Example:</p>
<div class="highlight-python"><pre>CooMatrix A(4);
A.add(0, 0, -1);
A.add(1, 1, -1);
A.add(2, 2, -1);
A.add(3, 3, -1);
A.add(0, 1, 2);
A.add(1, 0, 2);
A.add(1, 2, 2);
A.add(2, 1, 2);
A.add(2, 3, 2);
A.add(3, 2, 2);

double res[4] = {1., 1., 1., 1.};

solve_linear_system_dense_lu(&amp;A, res);
_assert(fabs(res[0] - 0.2) &lt; EPS);
_assert(fabs(res[1] - 0.6) &lt; EPS);
_assert(fabs(res[2] - 0.6) &lt; EPS);
_assert(fabs(res[3] - 0.2) &lt; EPS);</pre>
</div>
<p>You can use any other solver instead of <tt class="docutils literal"><span class="pre">solve_linear_system_dense_lu</span></tt>.</p>
<p>The solvers handle nonsymmetric matrices just fine, for example:</p>
<div class="highlight-python"><pre>CooMatrix A(5);
A.add(0, 0, 2);
A.add(0, 1, 3);
A.add(1, 0, 3);
A.add(1, 2, 4);
A.add(1, 4, 6);
A.add(2, 1, -1);
A.add(2, 2, -3);
A.add(2, 3, 2);
A.add(3, 2, 1);
A.add(4, 1, 4);
A.add(4, 2, 2);
A.add(4, 4, 1);

double res[5] = {8., 45., -3., 3., 19.};
solve_linear_system_numpy(&amp;A, res);
_assert(fabs(res[0] - 1.) &lt; EPS);
_assert(fabs(res[1] - 2.) &lt; EPS);
_assert(fabs(res[2] - 3.) &lt; EPS);
_assert(fabs(res[3] - 4.) &lt; EPS);
_assert(fabs(res[4] - 5.) &lt; EPS);</pre>
</div>
<p>As well as complex numbers, the following example shows that both numpy and
umfpack return the same (complex) solution:</p>
<div class="highlight-python"><pre>CooMatrix A(2, true);
A.add(0, 0, cplx(1, 1));
A.add(0, 1, cplx(2, 2));
A.add(1, 0, cplx(3, 3));
A.add(1, 1, cplx(4, 4));

cplx res[2];

//----------------------

res[0] = cplx(2, 1);
res[1] = cplx(2, 2);
solve_linear_system_numpy(&amp;A, res);
_assert(fabs(res[0].real() - (-1)) &lt; EPS);
_assert(fabs(res[1].real() - 1.25) &lt; EPS);
_assert(fabs(res[0].imag() - 1.) &lt; EPS);
_assert(fabs(res[1].imag() - (-0.75)) &lt; EPS);

res[0] = cplx(2, 1);
res[1] = cplx(2, 2);
solve_linear_system_scipy_umfpack(&amp;A, res);
_assert(fabs(res[0].real() - (-1)) &lt; EPS);
_assert(fabs(res[1].real() - 1.25) &lt; EPS);
_assert(fabs(res[0].imag() - 1.) &lt; EPS);
_assert(fabs(res[1].imag() - (-0.75)) &lt; EPS);</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">C++ documentation</a><ul>
<li><a class="reference external" href="#using-python">Using Python</a></li>
<li><a class="reference external" href="#matrix-support">Matrix Support</a><ul>
<li><a class="reference external" href="#coomatrix">CooMatrix</a></li>
<li><a class="reference external" href="#csrmatrix-and-coomatrix">CSRMatrix and CooMatrix</a></li>
</ul>
</li>
<li><a class="reference external" href="#solvers">Solvers</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="../index.html"
                                  title="previous chapter">Welcome to hermes_common&#8217;s documentation!</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="python.html"
                                  title="next chapter">Python documentation</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../sources/src/cpp.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="python.html" title="Python documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="Welcome to hermes_common’s documentation!"
             >previous</a> |</li>
        <li><a href="../index.html">hermes_common v0.5 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, hp-FEM group at UNR.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.
    </div>
  </body>
</html>